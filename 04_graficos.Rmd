---
output: 
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
background-image: url(www/slide1.png)
background-size: cover

<link rel="stylesheet" type="text/css" href="www/enap.css">


---

```{r setup, include=FALSE}
options(max.print = 30, digits = 4)
knitr::opts_chunk$set(fig.align = "center", fig.width = 10, fig.height = 6)
library(tidyverse)
```

# Percurso do curso

<br/>
<br/>

1. Noções de **R**

2. Ciclo da ciência de dados e tidyverse

3. União de dados

4. Lidando com textos

5. **Funções**

6. Comunicação: Gráficos

7. Comunicação: Markdown e shiny

---

# Percurso de hoje

1. Etiquetas

2. Anotações

3. Escalas

4. Zoom

5. Temas

6. Exportando gráficos

---

# Dados

```{r}
imdb <- read_rds("dados/imdb.rds")

filmes_recentes <- imdb %>% 
  filter(ano >= 2015) %>% 
  mutate(orcamento = orcamento / 1000000,
         receita = receita / 1000000, # em milhões
         lucro = receita - orcamento) 
```

---

# Etiquetas



```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  labs(
    title = "Filmes após 2015",
    subtitle = "Subtítulo do gráfico",
    caption = "Fonte: IMDb"
  )

```

---

# Etiquetas



```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  labs(
    x = "Duração (em minutos)",
    y = "Receita (em milhões de US$)",
    col = "Classificação"
  )

```

---

# Anotações

```{r}
label <- tibble(
  duracao = Inf,
  receita = Inf,
  label = "Uma anotação no meu gráfico"
)
```

---

# Anotações

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita)) +
  geom_point() +
  geom_text(aes(label = label), 
            data = label, vjust = "top", 
            hjust = "right")
```

---

# Escalas

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() 
```

---

# Escalas

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  scale_x_continuous() +
  scale_y_continuous() +
  scale_colour_discrete()
```

---

# Escalas

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  scale_y_continuous(breaks = seq(100, 500, 100))
```


---

# Escalas

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  scale_y_continuous(labels = NULL)
```

---

# Escalas

A legenda pode ser posicionada em "top", "bottom",  "left",  "right".

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  theme(legend.position = "left")
```

---

# Escalas

As escalas padrões podem ser substituídas.

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  scale_colour_brewer(palette = "Set1")

```

---

# Escalas

As escalas padrões podem ser substituídas.

```{r}
ggplot(filmes_recentes, 
       aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  scale_colour_manual(values = c(
    "A partir de 13 anos" = "orange",
    "Livre" = "darkblue", "Outros" = "gray", 
    "A partir de 18 anos" = "#ff0000"
))

```

---

# Zoom

Há três maneiras de controlar os limites de um gráfico:

1. Filtrar os dados

2. Alterar os limites em cada escala

3. Alterar `xlim` e `ylim` em `coord_cartesian()`.


---

# Zoom


```{r}
filmes_recentes %>% 
  filter(between(duracao, 75, 150)) %>% 
  ggplot(aes(duracao, receita, 
           col = classificacao)) +
  geom_point()
```

---

# Zoom


```{r}
filmes_recentes %>% 
  ggplot(aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  coord_cartesian(xlim = c(75, 150))
```

---

# Temas

```{r}
filmes_recentes %>% 
  ggplot(aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  theme_bw()
```

---

# Temas

```{r}
filmes_recentes %>% 
  ggplot(aes(duracao, receita, 
           col = classificacao)) +
  geom_point() +
  theme_minimal()
```

---

# Temas

Para conhecer outros temas acesse: [este endereço](https://github.com/jrnold/ggthemes)

---

# Exportando gráficos

O `ggplot2` disponibiliza uma função para salvar gráficos.

```{r}
# salva o último gráfico
ggsave("my-plot.pdf") # sabe que é pdf 
ggsave("my-plot.png") # sabe que é imagem
```

---

# Exportando gráficos

Para salvar de uma imagem podemos usar `pdf()` ou `png()`. 

Nesse casos lembre de "desligar" o "modo salvar".

```{r, eval = FALSE}
pdf() # ou png()
meu_grafico1
meu_grafico2
meu_grafico3
dev.off()
```

Atenção! Os gráficos param de aparecer no RStudio quando o 
"modo salvar" estiver ligado.
